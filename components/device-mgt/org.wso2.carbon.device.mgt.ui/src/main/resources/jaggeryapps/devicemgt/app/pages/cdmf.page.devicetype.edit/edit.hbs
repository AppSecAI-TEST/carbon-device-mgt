{{!
  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.

  WSO2 Inc. licenses this file to you under the Apache License,
  Version 2.0 (the "License"); you may not use this file except
  in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied. See the License for the
  specific language governing permissions and limitations
  under the License.
}}
{{unit "cdmf.unit.ui.title" pageTitle="Device Type Management"}}

{{#zone "topCss"}}
    {{css "css/devicetype.css"}}
{{/zone}}

{{#zone "breadcrumbs"}}
    <li>
        <a href="{{@app.context}}/">
            <i class="icon fw fw-home"></i>
        </a>
    </li>
    <li>
        <!--suppress HtmlUnknownTarget -->
        <a href="{{@app.context}}/device-types">
            Device Types
        </a>
    </li>
    <li>
        <!--suppress HtmlUnknownTarget -->
        <a href="{{@app.context}}/device-type/edit?type={{name}}">
            Edit
        </a>
    </li>
{{/zone}}

{{#zone "content"}}
    {{#if canManage}}
        <!-- content/body -->
        <div class="row">
            <div class="col-md-12">
                <!-- content -->
                <div id="devicetype-create-form" class="container col-centered wr-content">
                <div class="wr-form">
                    <p class="page-sub-title">{{name}}</p>
                    <hr/>
                    <div class="row">
                        <div class="col-lg-8">
                            <div id="devicetype-create-error-msg" class="alert alert-danger hidden" role="alert">
                                <i class="icon fw fw-error"></i><span></span>
                            </div>
                            <br>
                            <input aria-describedby="basic-addon1" type="text" id="deviceTypeName"
                                   data-error-msg="invalid device type name" class="form-control hidden-input" value="{{name}}"/>

                            <label class="wr-input-label">
                                Device Type Description *
                            </label>
                            <br>
                            <textarea aria-describedby="basic-addon1" type="text" id="deviceTypeDescription"
                                      data-error-msg="invalid device type description"
                                      class="form-control" rows="3" cols="70">{{type.deviceTypeMetaDefinition.description}}</textarea>

                            <label class="wr-input-label">Push Notification Transport</label>
                            <div class="wr-input-control">
                                <!--suppress HtmlFormInputWithoutLabel -->
                                <select id="pushNotification" class="form-control select">
                                    {{#if type.deviceTypeMetaDefinition.pushNotificationConfig}}
                                        <option>NONE</option>
                                        {{#if_eq type.deviceTypeMetaDefinition.pushNotificationConfig.type "MQTT"}}
                                            <option selected>MQTT</option>
                                            <option>FCM</option>
                                            <option>APNS</option>
                                        {{/if_eq}}
                                        {{#if_eq type.deviceTypeMetaDefinition.pushNotificationConfig.type "FCM"}}
                                            <option>MQTT</option>
                                            <option selected>FCM</option>
                                            <option>APNS</option>
                                        {{/if_eq}}
                                        {{#if_eq type.deviceTypeMetaDefinition.pushNotificationConfig.type "APNS"}}
                                            <option>MQTT</option>
                                            <option>FCM</option>
                                            <option selected>APNS</option>
                                        {{/if_eq}}
                                    {{else}}
                                        <option selected>NONE</option>
                                        <option>MQTT</option>
                                        <option>FCM</option>
                                        <option>APNS</option>
                                    {{/if}}



                                </select>
                            </div>

                            <label class="wr-input-label">
                                Features
                            </label>
                            <br>
                            <div class="form-group feature_field_wrapper">
                                {{#if type.deviceTypeMetaDefinition.features}}
                                    {{#each type.deviceTypeMetaDefinition.features}}
                                        <div class="dontfloat" name ="deviceFeature">
                                            <div class="col-xs-3">
                                                <input type="text" class="form-control" id="feature-name" placeholder="name" value="{{this.name}}"/>
                                            </div>
                                            <div class="col-xs-4">
                                                <input type="text" class="form-control" id="feature-code" placeholder="code" value="{{this.code}}"/>
                                            </div>
                                            <div class="col-xs-4">
                                            <textarea aria-describedby="basic-addon1" type="text" id="feature-description"
                                                      placeholder="description"data-error-msg="invalid feature description"class="form-control" rows="1" cols="30">
                                                {{this.description}}
                                            </textarea>
                                            </div>
                                            <button type="button" class="btn btn-default remove_feature_button"><i class="fa fa-minus"></i></button>
                                        </div>
                                    {{/each}}
                                {{/if}}
                                <div class="dontfloat" name="deviceFeature">
                                    <div class="col-xs-3">
                                        <input type="text" class="form-control" id="feature-name" placeholder="name"/>
                                    </div>
                                    <div class="col-xs-4">
                                        <input type="text" class="form-control" id="feature-code" placeholder="code"/>
                                    </div>
                                    <div class="col-xs-4">
                                        <textarea aria-describedby="basic-addon1" type="text" id="feature-description"
                                                  placeholder="description"
                                                  data-error-msg="invalid feature description"
                                                  class="form-control" rows="1" cols="30"></textarea>
                                    </div>
                                    <button type="button" class="btn btn-default add_feature_button"><i class="fa fa-plus"></i></button>
                                </div>
                            </div>

                            <br>
                            <label class="wr-input-label">
                                Device Attributes
                            </label>
                            <br>
                            <div class="form-group attribute_field_wrapper">
                                {{#if type.deviceTypeMetaDefinition.properties}}
                                    {{#each type.deviceTypeMetaDefinition.properties}}
                                        <div class="dontfloat">
                                            <div class="col-xs-3">
                                                <input type="text" class="form-control" name="attribute[]" value="{{this}}" />
                                            </div>
                                            <button type="button" class="btn btn-default remove_button"><i class="fa fa-minus"></i></button>
                                        </div>
                                    {{/each}}
                                {{/if}}
                                <div class="dontfloat">
                                    <div class="col-xs-3">
                                        <input type="text" class="form-control" name="attribute[]" />
                                    </div>
                                    <button type="button" class="btn btn-default add_button"><i class="fa fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="hidden-div">
                                <div id="add-attribute-field" name="add-attribute-field">
                                    <div class="dontfloat">
                                        <div class="col-xs-3">
                                            <input type="text" class="form-control" name="attribute[]" />
                                        </div>
                                        <button type="button" class="btn btn-default remove_button"><i class="fa fa-minus"></i></button>
                                    </div>
                                </div>
                            </div>

                            <label class="wr-input-label">
                                Initial Operation(Feature Code, Trigger operation when device enrolls)
                            </label>
                            <br>

                            <div class="form-group operation_field_wrapper">
                                {{#if type.deviceTypeMetaDefinition.initialOperationConfig}}
                                    {{#each type.deviceTypeMetaDefinition.initialOperationConfig.operations}}
                                        <div class="dontfloat">
                                            <div class="col-xs-3">
                                                <input type="text" class="form-control" name="operation[]" value="{{this}}"/>
                                            </div>
                                            <button type="button" class="btn btn-default remove_operation_button"><i class="fa fa-minus"></i></button>
                                        </div>
                                    {{/each}}
                                {{/if}}
                                <div class="dontfloat">
                                    <div class="col-xs-3">
                                        <input type="text" class="form-control" name="operation[]" />
                                    </div>
                                    <button type="button" class="btn btn-default add_operation_button"><i class="fa fa-plus"></i></button>
                                </div>

                            </div>
                            <div class="hidden-div">
                                <div id="add-operation-field" name="add-operation-field">
                                    <div class="dontfloat">
                                        <div class="col-xs-3">
                                            <input type="text" class="form-control" name="operation[]" />
                                        </div>
                                        <button type="button" class="btn btn-default remove_operation_button"><i class="fa fa-minus"></i></button>
                                    </div>
                                </div>
                            </div>


                            <label class="wr-input-label">Claimable</label>
                            <input aria-describedby="basic-addon1" type="checkbox" id="deviceClaimable"
                                {{#if type.deviceTypeMetaDefinition.claimable}}
                                   checked
                            {{/if}}/>
                            </br>

                            <label class="wr-input-label">Policy Monitoring</label>
                            <input aria-describedby="basic-addon1" type="checkbox" id="policyMonitoring"
                                {{#if type.deviceTypeMetaDefinition.policyMonitoringEnabled}}
                                   checked
                            {{/if}}/>
                            </br>


                            <span class="roleNameError hidden glyphicon glyphicon-remove form-control-feedback"></span>
                            <label class="error roleNameEmpty hidden" for="summary">
                                Device Type Name is required, should be in minimum 3 characters long and not include any
                                whitespaces or "@" character or "/" character.
                            </label>

                        </div>

                        </div>
                        <br>
                        <button id="add-devicetype-btn" class="wr-btn">Update</button>
                        <div id="devicetype-create-success-msg" class="alert hidden" role="alert">
                            <i class="icon fw fw-success"></i><span></span>
                        </div>
                    </div>
                </div>
                <div id="devicetype-created-msg" class="container col-centered wr-content hidden">
                    <div class="wr-form">
                        <p class="page-sub-title">Devicetype was added successfully.</p>
                        <b>"View Device Type List"</b> to complete the process and go back to the devie type list.
                        <hr/>
                        <button class="wr-btn" onclick="window.location.href='{{@app.context}}/device-types'">
                            View Device Type List
                        </button>
                    </div>
                </div>
                <!-- /content -->
                <div id="app-context" data-app-context="{{@app.context}}" class="hidden"></div>
            </div>
        </div>
        <!-- /content/body -->
    {{else}}
        <h1 class="page-sub-title">
            Permission Denied
        </h1>
        <br>
        You not authorized to edit device type.
        <br>
    {{/if}}
{{/zone}}

{{#zone "bottomJs"}}
    {{js "js/bottomJs.js"}}
{{/zone}}